<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>{{ session['email'] }} 的查验清关进度表（Wintime 清关系统）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 样式 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- DataTables 样式 -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">

  <!-- 日期选择器 Flatpickr 样式 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

  <style>
    body {
      padding: 2rem;
      background-color: #f5f5f5;
    }
    .theme-selector button {
      margin-right: 10px;
    }
    .dataTables_wrapper .dataTables_length, .dataTables_wrapper .dataTables_filter {
      margin-bottom: 1rem;
    }
    table.dataTable th,
    table.dataTable td {
      white-space: nowrap;
      vertical-align: middle;
    }
    .table-container {
      overflow-x: auto;
    }
  </style>
</head>
<body class="bg-light">

  <div class="container-fluid">
    <h2 class="text-center my-4"><i class="bi bi-bar-chart"></i> {{ session['email'] }} 的查验清关进度表 <small class="text-muted">Wintime 清关系统</small></h2>

    <!-- 日期与颜色选择栏 -->
    <div class="row mb-3">
      <div class="col-md-4">
        <input type="text" id="dateRange" class="form-control" placeholder="选择ETA日期范围">
      </div>
      <div class="col-md-4">
        <input type="text" id="searchInput" class="form-control" placeholder="输入关键词搜索...">
      </div>
      <div class="col-md-4 theme-selector">
        <div class="btn-group" role="group">
          <button class="btn btn-outline-secondary" onclick="setTheme('table-secondary')">灰</button>
          <button class="btn btn-outline-primary" onclick="setTheme('table-primary')">蓝</button>
          <button class="btn btn-outline-warning" onclick="setTheme('table-warning')">黄</button>
          <button class="btn btn-outline-success" onclick="setTheme('table-success')">绿</button>
          <button class="btn btn-outline-info" onclick="setTheme('table-info')">紫</button>
        </div>
      </div>
    </div>

    <!-- 表格容器 -->
    <div class="table-container">
      <table id="dataTable" class="table table-striped table-hover table-bordered">
        <thead>
          <tr>
            {% for header in headers %}
              <th>{{ header }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in tables %}
            <tr>
              {% for cell in row.values() %}
                <td>{{ cell }}</td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- JS 库 -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <!-- DataTables 和插件 -->
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>
    // 日期选择
    flatpickr("#dateRange", {
      mode: "range",
      dateFormat: "Y-m-d"
    });

    // 初始化表格
    $(document).ready(function() {
      window.table = $('#dataTable').DataTable({
        responsive: true,
        autoWidth: false,
        dom: 'Bfrtip',
        pageLength: 10,
        lengthMenu: [10, 20, 30, 40],
        buttons: [
          {
            extend: 'excelHtml5',
            text: '导出 Excel'
          },
          {
            extend: 'pdfHtml5',
            text: '导出 PDF'
          },
          {
            extend: 'print',
            text: '打印'
          }
        ]
      });
    });

    // 表格主题切换
    function setTheme(themeClass) {
      const table = document.querySelector('#dataTable');
      table.className = `table table-bordered table-hover ${themeClass}`;
    }

    // 搜索并高亮
    document.getElementById("searchInput").addEventListener("keyup", function () {
      let input = this.value.toLowerCase();
      let rows = document.querySelectorAll("#dataTable tbody tr");

      rows.forEach(row => {
        let text = row.textContent.toLowerCase();
        if (text.includes(input)) {
          row.style.display = "";
          row.querySelectorAll("td").forEach(cell => {
            let content = cell.textContent;
            if (content.toLowerCase().includes(input)) {
              cell.innerHTML = content.replace(
                new RegExp(input, "gi"),
                match => `<mark>${match}</mark>`
              );
            } else {
              cell.innerHTML = content;
            }
          });
        } else {
          row.style.display = "none";
        }
      });
    });
  </script>
</body>
</html>
